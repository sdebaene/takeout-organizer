# Google Takeout Extract Tgz files

A set of tools to help organize and process Google Takeout data. This project helps you:
1. Extract and merge multiple Takeout archives
2. Update metadata for photos and videos using the json files provided by Google Takeout

## First Step: Extracting Takeout Archives

The first step in organizing your Google Takeout data is to extract the .tgz archives. The `extract_takeout.py` script helps you do this efficiently.

### Features

- Extracts multiple .tgz files in parallel for faster processing
- Automatically merges contents from multiple Takeout archives
- Handles file conflicts by appending numbers to duplicate filenames
- Moves processed .tgz files to a separate directory for easy cleanup
- Uses multiple CPU cores for optimal performance

### Usage

1. Place all your Google Takeout .tgz files in a directory
2. Run the script:
   ```bash
   python extract_takeout.py /path/to/takeout/archives
   ```

The script will:
- Create a `Takeout` directory containing all extracted and merged files
- Create a `to_delete` directory containing the original .tgz files
- Process files in parallel using multiple CPU cores
- Show progress and results

### Example

```bash
# If your .tgz files are in the current directory
python extract_takeout.py .

# Or specify a different directory
python extract_takeout.py /path/to/your/takeout/files
```

### Output

After processing, you'll have:
- `Takeout/` - Contains all your extracted and merged data
- `to_delete/` - Contains the original .tgz files (can be deleted after verification)

### Notes

- The script leaves one CPU core free for system operations
- Processing speed depends on your CPU cores, file sizes, and storage speed
- Verify the contents of the `Takeout` directory before deleting the original .tgz files

## Second Step: Updating Metadata

After extracting your Takeout archives, you can use the metadata updater to restore important information like creation dates, locations, and camera details that might be lost during the export process.

# Google Takeout Metadata Updater

This script is specifically designed to process and organize media files exported from Google Takeout. It updates metadata for photos and videos using the supplemental metadata JSON files that Google provides in the Takeout archive. This helps restore important information like creation dates, locations, and camera details that might be lost during the export process.

After what felt like an eternity (and probably was) dealing with Google Takeout's endless quirks, I've emerged from the metadata abyss with this solution. I've seen things you wouldn't believe - JSON files that don't match their media files, timestamps that make no sense, and file formats that haven't been used since the dawn of digital photography. But fear not! This script has been battle-tested against:

- File names that look like they were generated by a cat walking on a keyboard
- JSON files that seem to be written in an ancient, forgotten language
- Metadata that changes format more often than Google changes their logo
- Video formats that should probably be in a museum
- RAW files that make you question your life choices

Consider this my gift to humanity - born from countless hours of frustration, many cups of coffee, and probably a few tears. May it save you from the same fate!

Is it perfect? Probably not. But after wrestling with Google's metadata madness for what felt like several lifetimes, I reached a point where I said "good enough" and moved on with my life. If you're like me and just want your photos and videos to have their proper dates, locations, and camera info without losing your sanity, this script should do the trick.

## Features

- Specifically designed for Google Takeout exported media files
- Updates metadata for both images and videos from Google Photos
- Handles Google's supplemental metadata JSON format
- Supports all image formats used by Google Photos:
  - Common formats: JPEG, PNG, GIF, WebP
  - Apple formats: HEIC, HEIF
  - RAW formats: CR2, CRW, NEF, DNG, RW2
  - Other formats: AVIF, JP2, PSD, TIFF
- Supports all video formats used by Google Photos:
  - Modern formats: MP4, MOV, MKV, WebM
  - Legacy formats: AVI, MPG, MPEG, MPE (automatically converted to MP4)
  - Other formats: 3GP, ASF, DIVX, FLV, M4V, MOD, MTS, M2TS, TOD, WMV, VOB
- File Conversion Details:
  - Legacy video formats (AVI, MPG, MPEG, MPE) are automatically converted to MP4 using high-quality settings
  - Video conversion uses H.264 codec with slow preset and CRF 18 for best quality
  - Audio is converted to AAC with 192k bitrate
  - Original files are deleted only after successful conversion and metadata update
  - No other file formats are converted - all other files keep their original format
- Preserves original files during processing
- Supports parallel processing for better performance
- Includes a dry-run mode for safe testing
- Maintains Google's metadata structure and format

## Prerequisites

- Python 3.6 or higher
- ExifTool (for handling certain file formats)
- FFmpeg (for video processing)

## Installation

1. Clone this repository or download the script
2. Install ExifTool (if not already installed):
   - macOS: `brew install exiftool`
   - Linux: `sudo apt-get install exiftool`
   - Windows: Download from [exiftool.org](https://exiftool.org/)
3. Install FFmpeg (if not already installed):
   - macOS: `brew install ffmpeg`
   - Linux: `sudo apt-get install ffmpeg`
   - Windows: Download from [ffmpeg.org](https://ffmpeg.org/)
4. Run the setup script:
   ```bash
   # Make the script executable
   chmod +x setup.sh

   # Run the setup script
   ./setup.sh
   ```

The setup script will handle all the Python dependencies and create a virtual environment for you. It's like having a personal assistant who does all the boring setup work while you grab a coffee!

## Quick Start

Want to get up and running quickly? We've got you covered! Just run the setup script:

```bash
# Make the script executable
chmod +x setup.sh

# Run the setup script
./setup.sh
```

This magical script will:
1. Create a Python virtual environment (if it doesn't exist)
2. Install all required Python packages
3. Set up everything you need to get started
4. Keep your system's Python installation clean and tidy

After the setup completes, you'll be ready to process your Google Takeout files. The script even activates the virtual environment for you, so you can start using the metadata updater right away!

## Usage

### Basic Usage

```bash
python update_metadata.py /path/to/takeout_folder/Google Photos
```

This will:
1. Scan the specified Google Photos directory for media files and JSON files
2. Match JSON files with their corresponding media files
3. Update the metadata of media files using information from JSON files
4. Delete the JSON files after successful metadata updates

### Dry Run Mode

To preview changes without actually modifying any files:

```bash
python update_metadata.py /path/to/takeout_folder/Google Photos --dry-run
```

This will show what changes would be made without actually making them.

### File Organization

The script is designed to work with Google Takeout's file structure:
- Media files (e.g., `photo.jpg`, `video.mp4`)
- Google's supplemental metadata JSON files (e.g., `photo.jpg.json`, `video.mp4.json`)

The JSON files from Google Takeout contain metadata in this format:
```json
{
  "title": "Photo Title",
  "description": "Photo Description",
  "photoTakenTime": {
    "timestamp": "1577836800",
    "formatted": "Jan 1, 2020, 12:00:00 AM UTC"
  },
  "geoData": {
    "latitude": 37.7749,
    "longitude": -122.4194,
    "altitude": 0
  },
  "cameraMake": "Camera Make",
  "cameraModel": "Camera Model"
}
```

### Supported File Formats

#### Images
- Common formats: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`
- RAW formats: `.cr2`, `.crw`, `.nef`, `.raw`, `.rw2`, `.dng`
- HEIC/HEIF: `.heic`, `.heif`
- Other formats: `.avif`, `.jp2`, `.psd`, `.tif`, `.tiff`

#### Videos
- Modern formats: `.mp4`, `.mov`, `.mkv`, `.webm`
- Legacy formats: `.avi`, `.mpg`, `.mpeg`, `.mpe` (will be converted to MP4)
- Other formats: `.3gp`, `.3gpp`, `.3g2`, `.asf`, `.divx`, `.flv`, `.m4v`, `.mod`, `.mts`, `.m2ts`, `.m2t`, `.tod`, `.wmv`, `.vob`

## Error Handling

- The script creates temporary files during processing and cleans them up automatically
- If an error occurs during processing, the original files are preserved
- Error messages are displayed in the console
- Failed operations are logged for review

## Performance

- The script uses parallel processing to handle multiple files simultaneously
- Number of parallel processes is automatically set to (CPU cores - 1)
- Large files may take longer to process, especially videos

## Safety Features

- Dry-run mode for testing
- Creates temporary files instead of modifying originals directly
- Verifies file operations before committing changes
- Preserves original files in case of errors
- Handles file conflicts gracefully

## Troubleshooting

1. **"ExifTool is not installed" error**
   - Install ExifTool using the instructions in the Installation section

2. **"FFmpeg error"**
   - Ensure FFmpeg is installed and in your system PATH
   - Check if the video file is corrupted or in an unsupported format

3. **JSON files not being matched**
   - Verify that JSON filenames match their corresponding media files
   - Check that JSON files contain valid Google Takeout metadata
   - Ensure you're using the correct Google Takeout JSON format

4. **Permission errors**
   - Ensure you have read/write permissions for the target directory
   - Run the script with appropriate permissions

5. **Missing metadata**
   - Verify that the Google Takeout export included metadata
   - Check if the JSON files are present in the same directory as the media files
   - Ensure the JSON files are not empty or corrupted

## License

This project is licensed under the MIT License - see the LICENSE file for details. 
